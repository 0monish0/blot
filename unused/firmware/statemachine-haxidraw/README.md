Adapted from Jake Read's code written for Modular Things with help from Quentin Bolsee.